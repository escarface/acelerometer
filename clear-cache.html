<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limpiar Cache PWA</title>
    <style>
        body {
            font-family: system-ui;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto;
        }
        button {
            padding: 15px 30px;
            font-size: 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #5568d3;
        }
        #log {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Limpieza de Cache PWA</h1>
    <p>Use estos botones para limpiar el cache y service worker de la aplicación:</p>
    
    <button onclick="clearCache()">Limpiar Cache</button>
    <button onclick="unregisterSW()">Desregistrar Service Worker</button>
    <button onclick="reloadApp()">Recargar App</button>
    <button onclick="clearAll()">Limpiar TODO</button>
    
    <div id="log"></div>
    
    <script>
        const log = document.getElementById('log');
        
        function addLog(message) {
            log.textContent += message + '\n';
            console.log(message);
        }
        
        async function clearCache() {
            addLog('Limpiando caches...');
            const cacheNames = await caches.keys();
            addLog(`Encontrados ${cacheNames.length} caches: ${cacheNames.join(', ')}`);
            
            for (const cacheName of cacheNames) {
                await caches.delete(cacheName);
                addLog(`✓ Cache eliminado: ${cacheName}`);
            }
            
            addLog('✓ Todos los caches limpiados');
        }
        
        async function unregisterSW() {
            addLog('Desregistrando service workers...');
            const registrations = await navigator.serviceWorker.getRegistrations();
            addLog(`Encontrados ${registrations.length} service workers`);
            
            for (const registration of registrations) {
                await registration.unregister();
                addLog(`✓ Service worker desregistrado`);
            }
            
            addLog('✓ Todos los service workers desregistrados');
        }
        
        async function clearAll() {
            await clearCache();
            await unregisterSW();
            
            // Limpiar localStorage también
            addLog('Limpiando localStorage...');
            const keys = Object.keys(localStorage);
            addLog(`localStorage tiene ${keys.length} items`);
            localStorage.clear();
            addLog('✓ localStorage limpiado');
            
            addLog('\n=== LISTO ===');
            addLog('Ahora recarga la página manualmente (F5 o Ctrl+R)');
        }
        
        function reloadApp() {
            window.location.href = '/';
        }
        
        addLog('Herramienta de limpieza lista');
        addLog('Selecciona una opción arriba\n');
    </script>
</body>
</html>
